<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Platform engine</title>
    <h1>Labyrinth game</h1>
    <link rel="stylesheet" type="text/css" href="css/style.css"/>
    <script type="text/javascript" src="platform-engine.js"></script>
    <script type="text/javascript" src="Maps/map1.js"></script>
    <script type="text/javascript" src="Maps/map2.js"></script>
    <script type="text/javascript" src="Maps/map3.js"></script>
</head>
<body>
<canvas id="canvas"></canvas>

<p>Death count:</p>
<p id="death_counter"></p>

<p class="info">
    Use arrows to move. As a player you have to get to the end of the Labyrinth.
    Remember you have 3 lives to complete all maps! 2 maps are included.
</p>
    <script type="text/javascript">

        window.requestAnimFrame =
            window.requestAnimationFrame || window.webkitRequestAnimationFrame ||
            window.mozRequestAnimationFrame || window.oRequestAnimationFrame ||  window.msRequestAnimationFrame ||
            function(callback) {
                return window.setTimeout(callback, 1000 / 60);
            };

        var canvas = document.getElementById('canvas'), ctx = canvas.getContext('2d');

        canvas.width = 400;
        canvas.height = 400;

        /* General map setup */
        var add_functionality = function (map) {
            /* Gravity */
            map.gravity = {
                x: 0,
                y: 0.3
            };
            /* Velocity limits */
            map.vel_limit = {
                x: 2,
                y: 16
            };
            /* Movement speeds */
            map.movement_speed = {
                jump: 6,
                left: 0.3,
                right: 0.3
            };
        };

        var add_scripts = function (themap) {
            themap.script = {
                change_colour: 'game.player.colour = "#"+(Math.random()*0xFFFFFF<<0).toString(16);',
                next_level: 'alert("Yay! You made it through the map, onwards to the next!"); death_counter = 0; game.load_map(list_of_maps[++map_counter]);',
                death: '++death_counter; if(death_counter === 3) { alert("You died! Start again."); death_counter = 0; map_counter = 0; game.load_map(list_of_maps[map_counter]); } else { game.load_map(map_counter); } document.getElementById("death_counter").innerHTML = death_counter;',
                unlock: 'game.current_map.keys[10].solid = 0;game.current_map.keys[10].colour = "#888";'
            };
        };

        /* Game setup */
        var game = new Labyrinth();
        game.set_viewport(canvas.width, canvas.height);
        var list_of_maps = [map1, map2, map3];

        list_of_maps.forEach(function(entry) {
            add_functionality(entry);
            add_scripts(entry);
        });
        alert(map3.script.next_level);


        /* Adding scripts */
//        for(var i = 0; i < 3; i++) {
//            list_of_maps.get(i).script = {
//                change_colour: 'game.player.colour = "#"+(Math.random()*0xFFFFFF<<0).toString(16);',
//                next_level: 'alert("Yay! You made it through the map, onwards to the next!"); death_counter = 0; game.load_map(list_of_maps[++map_counter]);',
//                death: '++death_counter; if(death_counter === 3) {alert("You died! Start again."); death_counter = 0; map_counter = 0; game.load_map(list_of_maps[map_counter]);} else {game.load_map(map_counter);} document.getElementById("death_counter").innerHTML = death_counter;',
//                unlock: 'game.current_map.keys[10].solid = 0;game.current_map.keys[10].colour = "#888";'
//            }
//            if(i === list_of_maps.length-1) {
//                map.script.next_level = 'alert("Yay! You made it through the game!"); map_counter = 0; death_counter = 0; game.load_map(list_of_maps[map_counter);'
//            }
//        }

        game.load_map(list_of_maps[map_counter]);

        /* Limit the viewport to the confines of the map */
        game.limit_viewport = true;
        var Loop = function () {
            ctx.fillStyle = '#333';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            game.update();
            game.draw(ctx);
            window.requestAnimFrame(Loop);
        }
        Loop();

    </script>
</body>
</html>



